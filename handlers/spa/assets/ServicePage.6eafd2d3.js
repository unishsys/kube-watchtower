import{Q as $,i as I}from"./QPage.1d199c80.js";import{c as A,r as x,C as j,D as z,E as O,f as U,h as K,d as L,l as M,b6 as G,s as F,y as H,aR as J,b7 as W,P as b,S as X,T as i,U as n,V as N,$ as S,a7 as _,b0 as R,a5 as B,a6 as h,a9 as P}from"./index.71d03583.js";import{Q as Y,a as Z,b as V}from"./QTable.eeb5d051.js";import{api as w}from"./axios.c02487b6.js";import{u as ee}from"./use-quasar.a2612bb9.js";var te=A({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(p,{slots:v,emit:f}){const k=M(),u=x(null);let d=0;const c=[];function C(l){const a=typeof l=="boolean"?l:p.noErrorFocus!==!0,t=++d,o=(s,r)=>{f("validation"+(s===!0?"Success":"Error"),r)},Q=s=>{const r=s.validate();return typeof r.then=="function"?r.then(m=>({valid:m,comp:s}),m=>({valid:!1,comp:s,err:m})):Promise.resolve({valid:r,comp:s})};return(p.greedy===!0?Promise.all(c.map(Q)).then(s=>s.filter(r=>r.valid!==!0)):c.reduce((s,r)=>s.then(()=>Q(r).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(s=>[s])).then(s=>{if(s===void 0||s.length===0)return t===d&&o(!0),!0;if(t===d){const{comp:r,err:m}=s[0];if(m!==void 0&&console.error(m),o(!1,r),a===!0){const D=s.find(({comp:E})=>typeof E.focus=="function"&&G(E.$)===!1);D!==void 0&&D.comp.focus()}}return!1})}function e(){d++,c.forEach(l=>{typeof l.resetValidation=="function"&&l.resetValidation()})}function q(l){l!==void 0&&F(l);const a=d+1;C().then(t=>{a===d&&t===!0&&(p.onSubmit!==void 0?f("submit",l):l!==void 0&&l.target!==void 0&&typeof l.target.submit=="function"&&l.target.submit())})}function y(l){l!==void 0&&F(l),f("reset"),H(()=>{e(),p.autofocus===!0&&p.noResetFocus!==!0&&g()})}function g(){J(()=>{if(u.value===null)return;const l=u.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||u.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||u.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(u.value.querySelectorAll("[tabindex]"),a=>a.tabIndex!==-1);l!=null&&l.focus({preventScroll:!0})})}j(W,{bindComponent(l){c.push(l)},unbindComponent(l){const a=c.indexOf(l);a!==-1&&c.splice(a,1)}});let T=!1;return z(()=>{T=!0}),O(()=>{T===!0&&p.autofocus===!0&&g()}),U(()=>{p.autofocus===!0&&g()}),Object.assign(k.proxy,{validate:C,resetValidation:e,submit:q,reset:y,focus:g,getValidationComponents:()=>c}),()=>K("form",{class:"q-form",ref:u,onSubmit:q,onReset:y},L(v.default))}});const oe={style:{"margin-left":"5%"}},ae={class:"row q-pa-md"},le={key:0},ne={key:0,class:"row q-pa-md"},se={key:1,class:"row q-pa-md"},re={key:2,class:"row q-pa-md"},ie={key:3,style:{width:"fit-content"}},fe={__name:"ServicePage",setup(p){const v=ee(),f=x([]),k=x([]),u=x([]),d=x([]),c=["TCP","UDP"],C=["NodePort","LoadBalancer","ClusterIP"],e=x({name:null,namespace:null,labels:{app:null},containerPort:null,servicePort:null,protocol:"TCP",selector:{app:null},type:null});function q(){w.get("/api/v1/get-namespaces").then(a=>{k.value=a.data.data})}function y(){w.get(`/api/v1/deploy/${e.value.namespace}`).then(a=>{f.value=a.data.data.map(t=>t.name),u.value=a.data.data}).catch(a=>{v.notify({color:"error",position:"top-right",message:a.message,icon:"report_problem"})}),w.get(`/api/v1/svc/${e.value.namespace}`).then(a=>{d.value=a.data.data}).catch(a=>{v.notify({color:"error",position:"top-right",message:a.message,icon:"report_problem"})})}function g(a){console.log("Delete clicked for row:",a),w.delete(`/api/v1/svc/${e.value.namespace}/${a.name}`).then(t=>{v.notify({color:"success",position:"top-right",message:"Service Deleted: "+a.name,icon:"done"}),setTimeout(()=>{y()},3e3)}).catch(t=>{v.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})})}function T(){e.value={}}function l(){const a=u.value.find(t=>t.name===e.value.name);e.value.labels=a.labels,e.value.selector=a.labels,e.value.containerPort=parseInt(e.value.containerPort,10),e.value.servicePort=parseInt(e.value.servicePort,10),w.post("/api/v1/svc/",e.value).then(t=>{v.notify({color:t.data.status,position:"top-right",message:t.data.msg+": "+t.data.data.metadata.name,icon:"done"}),setTimeout(()=>{y()},3e3)}).catch(t=>{v.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})})}return U(q),(a,t)=>(b(),X($,{class:"flex"},{default:i(()=>[n(te,{modelValue:e.value,"onUpdate:modelValue":t[6]||(t[6]=o=>e.value=o),onSubmit:l,onReset:T,class:""},{default:i(()=>[N("div",oe,[N("div",ae,[n(I,{modelValue:e.value.namespace,"onUpdate:modelValue":[t[0]||(t[0]=o=>e.value.namespace=o),y],options:k.value,label:"Select Namespace",filled:"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue","options"]),e.value.namespace?(b(),S("div",le,[n(I,{modelValue:e.value.name,"onUpdate:modelValue":t[1]||(t[1]=o=>e.value.name=o),options:f.value,label:"Select Deployment",filled:"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue","options"])])):_("",!0)]),e.value.name?(b(),S("div",ne,[n(R,{filled:"",type:"number",modelValue:e.value.containerPort,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.containerPort=o),label:"Container Port *","lazy-rules":"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue"]),n(R,{filled:"",type:"number",modelValue:e.value.servicePort,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.servicePort=o),label:"Service Port *","lazy-rules":"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue"])])):_("",!0),e.value.containerPort&&e.value.servicePort?(b(),S("div",se,[n(I,{options:c,modelValue:e.value.protocol,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.protocol=o),label:"Service Protocol",filled:"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue"]),n(I,{options:C,modelValue:e.value.type,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.type=o),label:"Service Type",filled:"",style:{width:"180px","padding-right":"1em"}},null,8,["modelValue"])])):_("",!0),e.value.protocol&&e.value.type?(b(),S("div",re,[n(B,{label:"Submit",type:"submit",color:"primary",class:"q-pr-md"}),n(B,{label:"Reset",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])):_("",!0),e.value.namespace?(b(),S("div",ie,[n(Y,{title:"Services",rows:d.value,"row-key":"name",flat:"",bordered:""},{body:i(o=>[n(Z,{props:o},{default:i(()=>[n(V,{key:"name",props:o},{default:i(()=>[h(P(o.row.name),1)]),_:2},1032,["props"]),n(V,{key:"type",props:o},{default:i(()=>[h(P(o.row.type),1)]),_:2},1032,["props"]),n(V,{key:"clusterIp",props:o},{default:i(()=>[h(P(o.row.clusterIp),1)]),_:2},1032,["props"]),n(V,{key:"externalIp",props:o},{default:i(()=>[h(P(o.row.externalIp),1)]),_:2},1032,["props"]),n(V,{key:"ports",props:o},{default:i(()=>[h(P(o.row.ports),1)]),_:2},1032,["props"]),n(V,{key:"createdAt",props:o},{default:i(()=>[h(P(o.row.createdAt)+" ",1),n(B,{icon:"delete",onClick:Q=>g(o.row),color:"red-12",class:"q-ml-lg"},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])):_("",!0)])]),_:1},8,["modelValue"])]),_:1}))}};export{fe as default};

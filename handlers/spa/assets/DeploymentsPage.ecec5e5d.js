import{r,f as ce,P as u,$ as U,U as a,T as o,a1 as L,aa as pe,a2 as R,a8 as b,V as n,a9 as g,a0 as q,a6 as c,a$ as me,w as E,a5 as d,S as y,a7 as V,a3 as G,a4 as _,b0 as ve,b1 as X,Q as B,b2 as fe,b3 as ge}from"./index.e96496b9.js";import{Q as Z,a as ee,b as k,C as I}from"./ClosePopup.1493446b.js";import{Q as ye,i as _e}from"./QPage.368960c7.js";import{Q as he,a as be,b as w}from"./QTable.22326ad4.js";import{_ as ke,Q as we}from"./plugin-vue_export-helper.94baf0c9.js";import{api as x}from"./axios.10feeee0.js";import{u as xe}from"./use-quasar.feb177f4.js";import{V as Ce}from"./theme-tomorrow_night.38490234.js";const te=T=>(fe("data-v-4a3e3d7d"),T=T(),ge(),T),$e={class:"text-h6"},Ve=te(()=>n("div",{class:"text-h6"},"Response",-1)),Te=["innerHTML"],Qe=te(()=>n("div",{class:"text-h6"},"Logs Streaming",-1)),Se={id:"logdata"},De=["innerHTML"],ze={style:{"margin-left":"4%","margin-right":"4%","margin-top":"2%"}},qe={class:"full-width row wrap justify-start items-start content-stretch"},Ee={class:"col-6"},Ie={class:"q-mb-md q-pr-xl q-pt-xl"},Me={class:"neubutton"},Ae={class:"neubutton"},Ne={key:0},Pe={key:1},Ue={class:"row"},Le={class:"text-center"},Re={class:"q-ma-xl col-6 absolute-right"},Be={class:"row text-h5 text-weight-light q-mb-md",style:{"margin-left":"15%"}},Oe={class:"q-ml-md text-weight-bold"},He={class:"row q-pa-md q-gutter-sm"},Ke={__name:"DeploymentsPage",setup(T){const v=xe(),O=r([]),p=r(null),Q=r(null),H=r([]),M=r(!1),f=r(""),h=r(null),C=r(!1),S=r(!1),D=r(""),i=r(!1),$=r(null);let A="",K="";function ae(){x.get("/api/v1/get-namespaces").then(l=>{H.value=l.data.data})}function N(){p.value&&x.get(`/api/v1/deploy/${p.value}`).then(l=>{let t=l.data.data;t.forEach(e=>{delete e.labels}),O.value=t}).catch(l=>{v.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})})}function oe(l){const t=parseInt(l.replicas,10);x.post("/api/v1/deploy/",{namespace:p.value,name:l.name,replicas:t}).then(e=>{let s=e.data;v.notify({color:s.status,position:"top-right",message:s.msg+" -> "+l.replicas,icon:"done"}),setTimeout(()=>{N()},3e3)}).catch(e=>{v.notify({color:"error",position:"top-right",message:e.message,icon:"report_problem"})})}function le(l){x.get(`/api/v1/deploy/${p.value}/${l.name}/yaml`).then(t=>{f.value=t.data.data,Q.value=l.name}).catch(t=>{v.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})})}function se(){console.log(f.value),x.post(`/api/v1/deploy/${p.value}/${Q.value}/yaml`,{data:f.value},{headers:{"Content-Type":"application/json"}}).then(l=>{f.value=l.data.data,v.notify({progress:!0,color:l.data.status,position:"top-right",message:l.data.msg,icon:"done"}),setTimeout(()=>{N()},3e3)}).catch(l=>{v.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})})}function j(l){x.get(`/api/v1/deploy/${p.value}/${l.name}`).then(t=>{const e=t.data;A=ne(e)}).catch(t=>{v.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})}).finally(()=>{M.value=!0})}function ne(l){let t="";for(const e of l.data){K=e.name;for(const s of e.status)s.ready||(t+=`${s.name} container state is not ready because of ${s.state.waiting.reason}: ${s.state.waiting.message}.`)}return t===""&&(t="All containers are in a ready state."),t.trim()}async function ie(){let l=`you are an kubernetes and devops expert. for a given kubernetes deployment manifest in YAML format, you will provide only the missing best practices in htlm format use for code use pre tag and for text use p tag :
---
${f.value}`;const t=await fetch("http://localhost:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"mistral",prompt:l})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);h.value="",C.value=!0;const e=t.body.getReader(),s=async()=>{const{done:m,value:P}=await e.read();if(m){console.log("stream done");return}const Y=new TextDecoder("utf-8").decode(P),z=JSON.parse(Y);console.log(z.response),h.value+=z.response,s()};s()}function re(){h.value=null,C.value=!1}async function de(l){let t=`you are an kubernetes and devops expert. for a given kubernetes error message, you will provide most possible debugging points try to keep them as concise as possible in htlm format use <pre></pre> tag for all your respose, do not use title or heading:
---
${l}`;const e=await fetch("http://localhost:11434/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"mistral",prompt:t})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);h.value="",C.value=!0;const s=e.body.getReader(),m=async()=>{const{done:P,value:W}=await s.read();if(P){console.log("stream done");return}const z=new TextDecoder("utf-8").decode(W),F=JSON.parse(z);console.log(F.response),h.value+=F.response,m()};m()}function J(){S.value=!1,D.value="",$.value.close()}function ue(l){let t=`ws://${window.location.host}/api/v1/logs/deploy/${p.value}/${l.name}`;$.value=new WebSocket(t),S.value=!0,D.value="",$.value.onmessage=e=>{D.value+=`<p class="text text-body1">${e.data}</p></br>`,setTimeout(()=>{var m=document.getElementById("logdata").lastElementChild;m.scrollIntoView({behavior:"smooth",block:"end"})},300)},$.value.onerror=e=>{$.value.close(),v.notify({color:"error",position:"top-right",message:e.message,icon:"report_problem"})}}return ce(ae),(l,t)=>(u(),U(pe,null,[a(L,{modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=e=>M.value=e)},{default:o(()=>[a(R,null,{default:o(()=>[a(b,null,{default:o(()=>[n("div",$e,"Pod: "+g(q(K)),1)]),_:1}),a(b,{class:"q-pt-none"},{default:o(()=>[c(g(q(A)),1)]),_:1}),a(me,{align:"right"},{default:o(()=>[E(a(d,{flat:"",label:"OK",color:"primary"},null,512),[[I]]),E(a(d,{flat:"",label:"Ask AI?",color:"secondary",onClick:t[0]||(t[0]=e=>de(q(A)))},null,512),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(L,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),persistent:"",maximized:i.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:o(()=>[a(R,{class:"bg-primary--dark"},{default:o(()=>[a(Z,null,{default:o(()=>[a(ee),a(d,{dense:"",flat:"",icon:"minimize",onClick:t[2]||(t[2]=e=>i.value=!1),disable:!i.value},{default:o(()=>[i.value?V("",!0):(u(),y(k,{key:0,class:"bg-white text-primary"},{default:o(()=>[c("Maximize")]),_:1}))]),_:1},8,["disable"]),a(d,{dense:"",flat:"",icon:"crop_square",onClick:t[3]||(t[3]=e=>i.value=!0),disable:i.value},{default:o(()=>[i.value?(u(),y(k,{key:0,class:"bg-white text-primary"},{default:o(()=>[c("Minimize")]),_:1})):V("",!0)]),_:1},8,["disable"]),E((u(),y(d,{dense:"",flat:"",icon:"close",onClick:re},{default:o(()=>[a(k,{class:"bg-white text-primary"},{default:o(()=>[c("Close")]),_:1})]),_:1})),[[I]])]),_:1}),a(b,null,{default:o(()=>[Ve]),_:1}),a(b,{class:"q-pt-none"},{default:o(()=>[n("div",{innerHTML:h.value},null,8,Te)]),_:1})]),_:1})]),_:1},8,["modelValue","maximized"]),a(L,{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=e=>S.value=e),persistent:"",maximized:i.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:o(()=>[a(R,{class:"bg-primary--dark",onKeyup:G(_(J,["prevent"]),["esc"]),tabindex:"0"},{default:o(()=>[a(Z,null,{default:o(()=>[a(ee),a(d,{dense:"",flat:"",icon:"minimize",onClick:t[5]||(t[5]=e=>i.value=!1),disable:!i.value},{default:o(()=>[i.value?V("",!0):(u(),y(k,{key:0,class:"bg-white text-primary"},{default:o(()=>[c("Maximize")]),_:1}))]),_:1},8,["disable"]),a(d,{dense:"",flat:"",icon:"crop_square",onClick:t[6]||(t[6]=e=>i.value=!0),disable:i.value},{default:o(()=>[i.value?(u(),y(k,{key:0,class:"bg-white text-primary"},{default:o(()=>[c("Minimize")]),_:1})):V("",!0)]),_:1},8,["disable"]),E((u(),y(d,{dense:"",flat:"",icon:"close",onClick:J},{default:o(()=>[a(k,{class:"bg-white text-primary"},{default:o(()=>[c("Close")]),_:1})]),_:1})),[[I]])]),_:1}),a(b,null,{default:o(()=>[Qe]),_:1}),a(b,{class:"q-pt-none"},{default:o(()=>[n("div",Se,[n("div",{innerHTML:D.value},null,8,De)])]),_:1})]),_:1},8,["onKeyup"])]),_:1},8,["modelValue","maximized"]),a(ye,null,{default:o(()=>[n("div",ze,[n("div",qe,[n("div",Ee,[n("div",Ie,[a(_e,{modelValue:p.value,"onUpdate:modelValue":[t[8]||(t[8]=e=>p.value=e),N],options:H.value,label:"Select Namespace"},null,8,["modelValue","options"])]),a(he,{flat:"",bordered:"",title:"Deploy",rows:O.value,"row-key":"name"},{body:o(e=>[a(be,{props:e},{default:o(()=>[a(w,{key:"name",props:e,onClick:_(s=>ue(e.row),["stop"])},{default:o(()=>[n("div",Me,g(e.row.name),1)]),_:2},1032,["props","onClick"]),a(w,{key:"replicas",props:e},{default:o(()=>[n("div",Ae,g(e.row.replicas),1),a(we,{modelValue:e.row.replicas,"onUpdate:modelValue":s=>e.row.replicas=s,title:"Update Replica"},{default:o(s=>[a(ve,{modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,dense:"",autofocus:"",onKeyup:G(s.set,["enter"]),hint:"Replica Count"},{after:o(()=>[a(d,{flat:"",dense:"",color:"negative",icon:"cancel",onClick:_(s.cancel,["stop","prevent"])},null,8,["onClick"]),a(d,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:[_(s.set,["stop","prevent"]),m=>oe(e.row)],disable:s.validate(s.value)===!1||s.initialValue===s.value},null,8,["onClick","disable"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),a(w,{key:"availableReplicas",props:e},{default:o(()=>[c(g(e.row.availableReplicas),1)]),_:2},1032,["props"]),a(w,{key:"readyReplicas",props:e},{default:o(()=>[c(g(e.row.readyReplicas),1)]),_:2},1032,["props"]),a(w,{key:"status",props:e,class:X(e.row.status),style:{"align-content":"center"}},{default:o(()=>[e.row.status==="success"?(u(),U("div",Ne,[a(B,{name:"check_circle",size:"2em",color:"green-12",onClick:_(s=>j(e.row),["stop"])},null,8,["onClick"])])):(u(),U("div",Pe,[a(B,{name:"error",size:"2em",color:"red-12",clickable:"",onClick:_(s=>j(e.row),["stop"])},null,8,["onClick"])]))]),_:2},1032,["props","class"]),a(w,{key:"createdAt",props:e,class:X(e.row.createdAt)},{default:o(()=>[n("div",Ue,[n("div",Le,g(e.row.createdAt.split("T")[0]),1),a(B,{name:"edit_square",size:"2em",color:"yellow-2",onClick:_(s=>le(e.row),["stop"])},null,8,["onClick"])])]),_:2},1032,["props","class"])]),_:2},1032,["props"])]),_:1},8,["rows"])]),n("div",Re,[n("div",null,[n("div",Be,[c("Editing "),n("span",Oe,g(Q.value),1)]),a(q(Ce),{style:{"margin-left":"15%"},value:f.value,"onUpdate:value":t[9]||(t[9]=e=>f.value=e),lang:"yaml",theme:"tomorrow_night",options:{autoScrollEditorIntoView:!0,copyWithEmptySelection:!0,fontSize:15,minLines:30,maxLines:50}},null,8,["value"])]),n("div",He,[a(d,{style:{"margin-left":"15%"},color:"secondary",label:"Update Deployment",clickable:"",onClick:t[10]||(t[10]=e=>se())}),f.value&&Q.value?(u(),y(d,{key:0,style:{"margin-left":"15%"},color:"blue-14",label:"Ask AI?",clickable:"",onClick:t[11]||(t[11]=e=>ie())})):V("",!0)])])])])]),_:1})],64))}};var et=ke(Ke,[["__scopeId","data-v-4a3e3d7d"]]);export{et as default};

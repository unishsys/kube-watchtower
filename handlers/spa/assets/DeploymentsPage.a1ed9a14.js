import{Z as D,_ as R,$ as T,g as A,r as f,f as B,P as g,a0 as v,U as a,T as l,a1 as S,a2 as I,a3 as L,a4 as Q,X as h,a5 as d,a6 as C,W as u,a7 as z,w as F,a8 as k,a9 as O,aa as W,ab as x,ac as N,Q as $}from"./index.93f69a73.js";import{Q as X,a as Z}from"./QPage.22c61efd.js";import{Q as j,a as G,b as p,c as H}from"./QTable.8d62474e.js";import{api as y}from"./axios.fbcd50c1.js";import{u as J}from"./use-quasar.b4ea623b.js";function P(o){if(o===!1)return 0;if(o===!0||o===void 0)return 1;const s=parseInt(o,10);return isNaN(s)?0:s}var Y=D({name:"close-popup",beforeMount(o,{value:s}){const i={depth:P(s),handler(c){i.depth!==0&&setTimeout(()=>{const m=R(o);m!==void 0&&T(m,c,i.depth)})},handlerKey(c){A(c,13)===!0&&i.handler(c)}};o.__qclosepopup=i,o.addEventListener("click",i.handler),o.addEventListener("keyup",i.handlerKey)},updated(o,{value:s,oldValue:i}){s!==i&&(o.__qclosepopup.depth=P(s))},beforeUnmount(o){const s=o.__qclosepopup;o.removeEventListener("click",s.handler),o.removeEventListener("keyup",s.handlerKey),delete o.__qclosepopup}});const ee={class:"text-h6"},ae={class:"col"},te={key:0},oe={key:1},ce={__name:"DeploymentsPage",setup(o){const s=J(),i=f([]),c=f(null),m=f([]),_=f(!1);let w="",b="";function U(){y.get("/api/v1/get-namespaces").then(r=>{m.value=r.data.data})}function E(){c.value&&y.get(`/api/v1/deploy/${c.value}`).then(r=>{i.value=r.data.data}).catch(r=>{s.notify({color:"error",position:"top-right",message:r.message,icon:"report_problem"})})}function K(r){const n=parseInt(r.replicas,10);y.post("/api/v1/deploy/",{namespace:c.value,name:r.name,replicas:n}).then(e=>{let t=e.data;s.notify({color:t.status,position:"top-right",message:t.msg+" -> "+r.replicas,icon:"done"})}).catch(e=>{s.notify({color:"error",position:"top-right",message:e.message,icon:"report_problem"})})}function M(r){y.get(`/api/v1/deploy/${c.value}/${r.name}`).then(n=>{const e=n.data;w=q(e)}).catch(n=>{s.notify({color:"error",position:"top-right",message:n.message,icon:"report_problem"})}).finally(()=>{_.value=!0})}function q(r){let n="";for(const e of r.data){b=e.name;for(const t of e.status)t.ready||(n+=`${t.name} container state is not ready because of ${t.state.waiting.reason}: ${t.state.waiting.message}.`)}return n===""&&(n="All containers are in a ready state."),n.trim()}return B(U),(r,n)=>(g(),v(I,null,[a(S,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=e=>_.value=e)},{default:l(()=>[a(L,null,{default:l(()=>[a(Q,null,{default:l(()=>[h("div",ee,"Pod: "+d(C(b)),1)]),_:1}),a(Q,{class:"q-pt-none"},{default:l(()=>[u(d(C(w)),1)]),_:1}),a(z,{align:"right"},{default:l(()=>[F(a(k,{flat:"",label:"OK",color:"primary"},null,512),[[Y]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(X,{class:"flex flex-center"},{default:l(()=>[h("div",null,[h("div",ae,[a(Z,{modelValue:c.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>c.value=e),E],options:m.value,label:"Select Namespace"},null,8,["modelValue","options"])]),a(j,{flat:"",bordered:"",title:"Deploy",rows:i.value,"row-key":"name","binary-state-sort":""},{body:l(e=>[a(G,{props:e},{default:l(()=>[a(p,{key:"name",props:e},{default:l(()=>[u(d(e.row.name),1)]),_:2},1032,["props"]),a(p,{key:"replicas",props:e},{default:l(()=>[u(d(e.row.replicas)+" ",1),a(H,{modelValue:e.row.replicas,"onUpdate:modelValue":t=>e.row.replicas=t,title:"Update Replica"},{default:l(t=>[a(O,{modelValue:t.value,"onUpdate:modelValue":V=>t.value=V,dense:"",autofocus:"",onKeyup:W(t.set,["enter"]),hint:"Replica Count"},{after:l(()=>[a(k,{flat:"",dense:"",color:"negative",icon:"cancel",onClick:x(t.cancel,["stop","prevent"])},null,8,["onClick"]),a(k,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:[x(t.set,["stop","prevent"]),V=>K(e.row)],disable:t.validate(t.value)===!1||t.initialValue===t.value},null,8,["onClick","disable"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),a(p,{key:"availableReplicas",props:e},{default:l(()=>[u(d(e.row.availableReplicas),1)]),_:2},1032,["props"]),a(p,{key:"readyReplicas",props:e},{default:l(()=>[u(d(e.row.readyReplicas),1)]),_:2},1032,["props"]),a(p,{key:"status",props:e,class:N(e.row.status),style:{"align-content":"center"}},{default:l(()=>[e.row.status==="success"?(g(),v("div",te,[a($,{name:"check_circle",size:"2rem",color:"green-7"})])):(g(),v("div",oe,[a($,{name:"error",size:"2rem",color:"red-7",clickable:"",onClick:t=>M(e.row)},null,8,["onClick"])]))]),_:2},1032,["props","class"]),a(p,{key:"createdAt",props:e,class:N(e.row.createdAt)},{default:l(()=>[u(d(e.row.createdAt),1)]),_:2},1032,["props","class"])]),_:2},1032,["props"])]),_:1},8,["rows"])])]),_:1})],64))}};export{ce as default};

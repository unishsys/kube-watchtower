import{c as R,r as m,a as I,ae as A,y as L,m as z,h as S,l as H,af as k,aT as W,aU as Y,aV as F,g as Z,f as X,P,Y as U,U as r,T as c,aQ as G,a0 as J,aW as ee,aX as N,V as p,$ as h,Z as B,_ as q,aY as te,w as oe,aZ as ae,a_ as le,a$ as x,b0 as K,Q as T}from"./index.c4201437.js";import{d as ne,Q as se,b as ie}from"./QPage.b571d28d.js";import{Q as re,a as ce,b}from"./QTable.38c09e30.js";import{api as w}from"./axios.5a8bb3c7.js";import{u as ue}from"./use-quasar.274daf03.js";import{V as de}from"./theme-tomorrow_night.9618d776.js";import"./rtl.b51694b1.js";function Q(e,a=new WeakMap){if(Object(e)!==e)return e;if(a.has(e))return a.get(e);const n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const s=e.valueOf();if(Object(s)!==s){const d=new e.constructor(s);return a.set(e,d),d}}return a.set(e,n),e instanceof Set?e.forEach(s=>{n.add(Q(s,a))}):e instanceof Map&&e.forEach((s,d)=>{n.set(d,Q(s,a))}),Object.assign(n,...Object.keys(e).map(s=>({[s]:Q(e[s],a)})))}var pe=R({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:a,emit:n}){const{proxy:s}=H(),{$q:d}=s,v=m(null),f=m(""),u=m("");let _=!1;const g=I(()=>A({initialValue:f.value,validate:e.validate,set:V,cancel:y,updatePosition:E},"value",()=>u.value,o=>{u.value=o}));function V(){e.validate(u.value)!==!1&&(C()===!0&&(n("save",u.value,f.value),n("update:modelValue",u.value)),$())}function y(){C()===!0&&n("cancel",u.value,f.value),$()}function E(){L(()=>{v.value.updatePosition()})}function C(){return z(u.value,f.value)===!1}function $(){_=!0,v.value.hide()}function M(){_=!1,f.value=Q(e.modelValue),u.value=Q(e.modelValue),n("beforeShow")}function D(){n("show")}function i(){_===!1&&C()===!0&&(e.autoSave===!0&&e.validate(u.value)===!0?(n("save",u.value,f.value),n("update:modelValue",u.value)):n("cancel",u.value,f.value)),n("beforeHide")}function l(){n("hide")}function t(){const o=a.default!==void 0?[].concat(a.default(g.value)):[];return e.title&&o.unshift(S("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&o.push(S("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[S(k,{flat:!0,color:e.color,label:e.labelCancel||d.lang.label.cancel,onClick:y}),S(k,{flat:!0,color:e.color,label:e.labelSet||d.lang.label.set,onClick:V})])),o}return Object.assign(s,{set:V,cancel:y,show(o){v.value!==null&&v.value.show(o)},hide(o){v.value!==null&&v.value.hide(o)},updatePosition:E}),()=>{if(e.disable!==!0)return S(ne,{ref:v,class:"q-popup-edit",cover:e.cover,onBeforeShow:M,onShow:D,onBeforeHide:i,onHide:l,onEscapeKey:y},t)}}});function O(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const a=parseInt(e,10);return isNaN(a)?0:a}var fe=W({name:"close-popup",beforeMount(e,{value:a}){const n={depth:O(a),handler(s){n.depth!==0&&setTimeout(()=>{const d=Y(e);d!==void 0&&F(d,s,n.depth)})},handlerKey(s){Z(s,13)===!0&&n.handler(s)}};e.__qclosepopup=n,e.addEventListener("click",n.handler),e.addEventListener("keyup",n.handlerKey)},updated(e,{value:a,oldValue:n}){a!==n&&(e.__qclosepopup.depth=O(a))},beforeUnmount(e){const a=e.__qclosepopup;e.removeEventListener("click",a.handler),e.removeEventListener("keyup",a.handlerKey),delete e.__qclosepopup}});const ve={class:"text-h6"},me={style:{"margin-left":"4%","margin-right":"4%","margin-top":"2%"}},ge={class:"full-width row wrap justify-start items-start content-stretch"},ye={class:"col-6"},he={class:"q-mb-md q-pr-xl q-pt-xl"},_e={class:"neubutton"},be={key:0},we={key:1},ke={class:"row"},Ve={class:"text-center"},Ce={class:"q-ma-xl col-6 absolute-right"},Se={class:"row text-h5 text-weight-light q-mb-md",style:{"margin-left":"15%"}},qe={class:"q-ml-md text-weight-bold"},xe={class:"q-pa-md q-gutter-sm"},Be={__name:"DeploymentsPage",setup(e){const a=ue(),n=m([]),s=m(null),d=m(""),v=m([]),f=m(!1);let u="",_="";const g=m("");function V(){w.get("/api/v1/get-namespaces").then(i=>{v.value=i.data.data})}function y(){s.value&&w.get(`/api/v1/deploy/${s.value}`).then(i=>{let l=i.data.data;l.forEach(t=>{delete t.labels}),n.value=l}).catch(i=>{a.notify({color:"error",position:"top-right",message:i.message,icon:"report_problem"})})}function E(i){const l=parseInt(i.replicas,10);w.post("/api/v1/deploy/",{namespace:s.value,name:i.name,replicas:l}).then(t=>{let o=t.data;a.notify({color:o.status,position:"top-right",message:o.msg+" -> "+i.replicas,icon:"done"}),setInterval(()=>{y()},3e3)}).catch(t=>{a.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})})}function C(i){w.get(`/api/v1/deploy/${s.value}/${i.name}/yaml`).then(l=>{g.value=l.data.data,d.value=i.name}).catch(l=>{a.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})})}function $(){console.log(g.value),w.post(`/api/v1/deploy/${s.value}/${d.value}/yaml`,{data:g.value},{headers:{"Content-Type":"application/json"}}).then(i=>{g.value=i.data.data,a.notify({progress:!0,color:i.data.status,position:"top-right",message:i.data.msg,icon:"done"}),setInterval(()=>{y()},3e3)}).catch(i=>{a.notify({color:"error",position:"top-right",message:i.message,icon:"report_problem"})})}function M(i){w.get(`/api/v1/deploy/${s.value}/${i.name}`).then(l=>{const t=l.data;u=D(t)}).catch(l=>{a.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})}).finally(()=>{f.value=!0})}function D(i){let l="";for(const t of i.data){_=t.name;for(const o of t.status)o.ready||(l+=`${o.name} container state is not ready because of ${o.state.waiting.reason}: ${o.state.waiting.message}.`)}return l===""&&(l="All containers are in a ready state."),l.trim()}return X(V),(i,l)=>(P(),U(J,null,[r(G,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t)},{default:c(()=>[r(ee,null,{default:c(()=>[r(N,null,{default:c(()=>[p("div",ve,"Pod: "+h(B(_)),1)]),_:1}),r(N,{class:"q-pt-none"},{default:c(()=>[q(h(B(u)),1)]),_:1}),r(te,{align:"right"},{default:c(()=>[oe(r(k,{flat:"",label:"OK",color:"primary"},null,512),[[fe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(se,null,{default:c(()=>[p("div",me,[p("div",ge,[p("div",ye,[p("div",he,[r(ie,{modelValue:s.value,"onUpdate:modelValue":[l[1]||(l[1]=t=>s.value=t),y],options:v.value,label:"Select Namespace"},null,8,["modelValue","options"])]),r(re,{flat:"",bordered:"",title:"Deploy",rows:n.value,"row-key":"name"},{body:c(t=>[r(ce,{props:t},{default:c(()=>[r(b,{key:"name",props:t},{default:c(()=>[q(h(t.row.name),1)]),_:2},1032,["props"]),r(b,{key:"replicas",props:t},{default:c(()=>[p("div",_e,h(t.row.replicas),1),r(pe,{modelValue:t.row.replicas,"onUpdate:modelValue":o=>t.row.replicas=o,title:"Update Replica"},{default:c(o=>[r(ae,{modelValue:o.value,"onUpdate:modelValue":j=>o.value=j,dense:"",autofocus:"",onKeyup:le(o.set,["enter"]),hint:"Replica Count"},{after:c(()=>[r(k,{flat:"",dense:"",color:"negative",icon:"cancel",onClick:x(o.cancel,["stop","prevent"])},null,8,["onClick"]),r(k,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:[x(o.set,["stop","prevent"]),j=>E(t.row)],disable:o.validate(o.value)===!1||o.initialValue===o.value},null,8,["onClick","disable"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),r(b,{key:"availableReplicas",props:t},{default:c(()=>[q(h(t.row.availableReplicas),1)]),_:2},1032,["props"]),r(b,{key:"readyReplicas",props:t},{default:c(()=>[q(h(t.row.readyReplicas),1)]),_:2},1032,["props"]),r(b,{key:"status",props:t,class:K(t.row.status),style:{"align-content":"center"}},{default:c(()=>[t.row.status==="success"?(P(),U("div",be,[r(T,{name:"check_circle",size:"2em",color:"green-12",onClick:x(o=>M(t.row),["stop"])},null,8,["onClick"])])):(P(),U("div",we,[r(T,{name:"error",size:"2em",color:"red-12",clickable:"",onClick:x(o=>M(t.row),["stop"])},null,8,["onClick"])]))]),_:2},1032,["props","class"]),r(b,{key:"createdAt",props:t,class:K(t.row.createdAt)},{default:c(()=>[p("div",ke,[p("div",Ve,h(t.row.createdAt.split("T")[0]),1),r(T,{name:"edit_square",size:"2em",color:"yellow-2",onClick:x(o=>C(t.row),["stop"])},null,8,["onClick"])])]),_:2},1032,["props","class"])]),_:2},1032,["props"])]),_:1},8,["rows"])]),p("div",Ce,[p("div",null,[p("div",Se,[q("Editing "),p("span",qe,h(d.value),1)]),r(B(de),{style:{"margin-left":"15%"},value:g.value,"onUpdate:value":l[2]||(l[2]=t=>g.value=t),lang:"yaml",theme:"tomorrow_night",options:{autoScrollEditorIntoView:!0,copyWithEmptySelection:!0,fontSize:15,minLines:30,maxLines:50}},null,8,["value"])]),p("div",xe,[r(k,{style:{"margin-left":"15%"},color:"secondary",label:"Update Deployment",clickable:"",onClick:l[3]||(l[3]=t=>$())})])])])])]),_:1})],64))}};export{Be as default};

import{r,f as le,P as g,$ as N,U as a,T as s,aS as L,a3 as se,aT as H,aU as V,V as n,a2 as u,a0 as $,a1 as p,aV as ne,w as I,ah as i,S as T,aW as P,aX as re,aY as ie,aZ as w,a_ as J,Q as U,a$ as de,b0 as ce}from"./index.2a1274be.js";import{_ as ue,Q as pe,a as me,b as z,c as fe,C as E}from"./plugin-vue_export-helper.bd5f010f.js";import{Q as ve,b as ge}from"./QPage.6ef82293.js";import{Q as ye,a as _e,b as _}from"./QTable.d4a155de.js";import{api as h}from"./axios.3518f398.js";import{u as he}from"./use-quasar.f210e037.js";import{V as be}from"./theme-tomorrow_night.e48d1346.js";import"./rtl.b51694b1.js";const we=k=>(de("data-v-6462f0eb"),k=k(),ce(),k),ke={class:"text-h6"},Ce=we(()=>n("div",{class:"text-h6"},"Response",-1)),xe=["innerHTML"],Ve={style:{"margin-left":"4%","margin-right":"4%","margin-top":"2%"}},$e={class:"full-width row wrap justify-start items-start content-stretch"},Te={class:"col-6"},Qe={class:"q-mb-md q-pr-xl q-pt-xl"},Se={class:"neubutton"},De={key:0},qe={key:1},Ae={class:"row"},Ne={class:"text-center"},Ie={class:"q-ma-xl col-6 absolute-right"},Pe={class:"row text-h5 text-weight-light q-mb-md",style:{"margin-left":"15%"}},Ue={class:"q-ml-md text-weight-bold"},ze={class:"row q-pa-md q-gutter-sm"},Ee={__name:"DeploymentsPage",setup(k){const m=he(),M=r([]),d=r(null),C=r(null),R=r([]),Q=r(!1),c=r(""),y=r(""),b=r(!1),f=r(!1);let S="",B="";function Y(){h.get("/api/v1/get-namespaces").then(l=>{R.value=l.data.data})}function D(){d.value&&h.get(`/api/v1/deploy/${d.value}`).then(l=>{let t=l.data.data;t.forEach(e=>{delete e.labels}),M.value=t}).catch(l=>{m.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})})}function W(l){const t=parseInt(l.replicas,10);h.post("/api/v1/deploy/",{namespace:d.value,name:l.name,replicas:t}).then(e=>{let o=e.data;m.notify({color:o.status,position:"top-right",message:o.msg+" -> "+l.replicas,icon:"done"}),setTimeout(()=>{D()},3e3)}).catch(e=>{m.notify({color:"error",position:"top-right",message:e.message,icon:"report_problem"})})}function F(l){h.get(`/api/v1/deploy/${d.value}/${l.name}/yaml`).then(t=>{c.value=t.data.data,C.value=l.name}).catch(t=>{m.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})})}function X(){console.log(c.value),h.post(`/api/v1/deploy/${d.value}/${C.value}/yaml`,{data:c.value},{headers:{"Content-Type":"application/json"}}).then(l=>{c.value=l.data.data,m.notify({progress:!0,color:l.data.status,position:"top-right",message:l.data.msg,icon:"done"}),setTimeout(()=>{D()},3e3)}).catch(l=>{m.notify({color:"error",position:"top-right",message:l.message,icon:"report_problem"})})}function O(l){h.get(`/api/v1/deploy/${d.value}/${l.name}`).then(t=>{const e=t.data;S=Z(e)}).catch(t=>{m.notify({color:"error",position:"top-right",message:t.message,icon:"report_problem"})}).finally(()=>{Q.value=!0})}function Z(l){let t="";for(const e of l.data){B=e.name;for(const o of e.status)o.ready||(t+=`${o.name} container state is not ready because of ${o.state.waiting.reason}: ${o.state.waiting.message}.`)}return t===""&&(t="All containers are in a ready state."),t.trim()}async function G(){let l=`you are an kubernetes expert you know all about Kubernetes best practices and securicy, also you know web development. for a given kubernetes deployment manifest in YAML format, you will provide only the missing best practices in htlm format with code example in pre tag :
---
${c.value}`;const e=await fetch("http://192.168.1.101:8001/v1/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"mistral",prompt:l,use_context:!0,stream:!0})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);y.value="",b.value=!0;const o=e.body.getReader(),v=async()=>{const{done:x,value:q}=await o.read();if(x){console.log("stream done");return}const K=new TextDecoder("utf-8").decode(q).split("data: ")[1],A=JSON.parse(K);y.value+=A.choices[0].delta.content,v()};v()}function ee(){y.value="",b.value=!1}async function te(l){let t=`you are an kubernetes expert you know all about Kubernetes best practices and securicy also you know web development. for a given kubernetes error message, you will provide most possible debugging points try to keep them as concise as possible in htlm format use <pre></pre> tag for all your respose, do not use title or heading:
---
${l}`;const o=await fetch("http://192.168.1.101:8001/v1/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"mistral",prompt:t,use_context:!0,stream:!0})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);y.value="",b.value=!0;const v=o.body.getReader(),x=async()=>{const{done:q,value:j}=await v.read();if(q){console.log("stream done");return}const A=new TextDecoder("utf-8").decode(j).split("data: ")[1],oe=JSON.parse(A);y.value+=oe.choices[0].delta.content,x()};x()}return le(Y),(l,t)=>(g(),N(se,null,[a(L,{modelValue:Q.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Q.value=e)},{default:s(()=>[a(H,null,{default:s(()=>[a(V,null,{default:s(()=>[n("div",ke,"Pod: "+u($(B)),1)]),_:1}),a(V,{class:"q-pt-none"},{default:s(()=>[p(u($(S)),1)]),_:1}),a(ne,{align:"right"},{default:s(()=>[I(a(i,{flat:"",label:"OK",color:"primary"},null,512),[[E]]),I(a(i,{flat:"",label:"Ask AI?",color:"secondary",onClick:t[0]||(t[0]=e=>te($(S)))},null,512),[[E]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(L,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e),persistent:"",maximized:f.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[a(H,{class:"bg-primary--dark"},{default:s(()=>[a(pe,null,{default:s(()=>[a(me),a(i,{dense:"",flat:"",icon:"minimize",onClick:t[2]||(t[2]=e=>f.value=!1),disable:!f.value},{default:s(()=>[f.value?P("",!0):(g(),T(z,{key:0,class:"bg-white text-primary"},{default:s(()=>[p("Maximize")]),_:1}))]),_:1},8,["disable"]),a(i,{dense:"",flat:"",icon:"crop_square",onClick:t[3]||(t[3]=e=>f.value=!0),disable:f.value},{default:s(()=>[f.value?(g(),T(z,{key:0,class:"bg-white text-primary"},{default:s(()=>[p("Minimize")]),_:1})):P("",!0)]),_:1},8,["disable"]),I((g(),T(i,{dense:"",flat:"",icon:"close",onClick:ee},{default:s(()=>[a(z,{class:"bg-white text-primary"},{default:s(()=>[p("Close")]),_:1})]),_:1})),[[E]])]),_:1}),a(V,null,{default:s(()=>[Ce]),_:1}),a(V,{class:"q-pt-none"},{default:s(()=>[n("div",{innerHTML:y.value},null,8,xe)]),_:1})]),_:1})]),_:1},8,["modelValue","maximized"]),a(ve,null,{default:s(()=>[n("div",Ve,[n("div",$e,[n("div",Te,[n("div",Qe,[a(ge,{modelValue:d.value,"onUpdate:modelValue":[t[5]||(t[5]=e=>d.value=e),D],options:R.value,label:"Select Namespace"},null,8,["modelValue","options"])]),a(ye,{flat:"",bordered:"",title:"Deploy",rows:M.value,"row-key":"name"},{body:s(e=>[a(_e,{props:e},{default:s(()=>[a(_,{key:"name",props:e},{default:s(()=>[p(u(e.row.name),1)]),_:2},1032,["props"]),a(_,{key:"replicas",props:e},{default:s(()=>[n("div",Se,u(e.row.replicas),1),a(fe,{modelValue:e.row.replicas,"onUpdate:modelValue":o=>e.row.replicas=o,title:"Update Replica"},{default:s(o=>[a(re,{modelValue:o.value,"onUpdate:modelValue":v=>o.value=v,dense:"",autofocus:"",onKeyup:ie(o.set,["enter"]),hint:"Replica Count"},{after:s(()=>[a(i,{flat:"",dense:"",color:"negative",icon:"cancel",onClick:w(o.cancel,["stop","prevent"])},null,8,["onClick"]),a(i,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:[w(o.set,["stop","prevent"]),v=>W(e.row)],disable:o.validate(o.value)===!1||o.initialValue===o.value},null,8,["onClick","disable"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),a(_,{key:"availableReplicas",props:e},{default:s(()=>[p(u(e.row.availableReplicas),1)]),_:2},1032,["props"]),a(_,{key:"readyReplicas",props:e},{default:s(()=>[p(u(e.row.readyReplicas),1)]),_:2},1032,["props"]),a(_,{key:"status",props:e,class:J(e.row.status),style:{"align-content":"center"}},{default:s(()=>[e.row.status==="success"?(g(),N("div",De,[a(U,{name:"check_circle",size:"2em",color:"green-12",onClick:w(o=>O(e.row),["stop"])},null,8,["onClick"])])):(g(),N("div",qe,[a(U,{name:"error",size:"2em",color:"red-12",clickable:"",onClick:w(o=>O(e.row),["stop"])},null,8,["onClick"])]))]),_:2},1032,["props","class"]),a(_,{key:"createdAt",props:e,class:J(e.row.createdAt)},{default:s(()=>[n("div",Ae,[n("div",Ne,u(e.row.createdAt.split("T")[0]),1),a(U,{name:"edit_square",size:"2em",color:"yellow-2",onClick:w(o=>F(e.row),["stop"])},null,8,["onClick"])])]),_:2},1032,["props","class"])]),_:2},1032,["props"])]),_:1},8,["rows"])]),n("div",Ie,[n("div",null,[n("div",Pe,[p("Editing "),n("span",Ue,u(C.value),1)]),a($(be),{style:{"margin-left":"15%"},value:c.value,"onUpdate:value":t[6]||(t[6]=e=>c.value=e),lang:"yaml",theme:"tomorrow_night",options:{autoScrollEditorIntoView:!0,copyWithEmptySelection:!0,fontSize:15,minLines:30,maxLines:50}},null,8,["value"])]),n("div",ze,[a(i,{style:{"margin-left":"15%"},color:"secondary",label:"Update Deployment",clickable:"",onClick:t[7]||(t[7]=e=>X())}),c.value&&C.value?(g(),T(i,{key:0,style:{"margin-left":"15%"},color:"blue-14",label:"Ask AI?",clickable:"",onClick:t[8]||(t[8]=e=>G())})):P("",!0)])])])])]),_:1})],64))}};var Je=ue(Ee,[["__scopeId","data-v-6462f0eb"]]);export{Je as default};
